!function t(e,s,i){function a(h,o){if(!s[h]){if(!e[h]){var r="function"==typeof require&&require;if(!o&&r)return r(h,!0);if(n)return n(h,!0);var c=new Error("Cannot find module '"+h+"'");throw c.code="MODULE_NOT_FOUND",c}var _=s[h]={exports:{}};e[h][0].call(_.exports,function(t){var s=e[h][1][t];return a(s?s:t)},_,_.exports,t,e,s,i)}return s[h].exports}for(var n="function"==typeof require&&require,h=0;h<i.length;h++)a(i[h]);return a}({1:[function(t,e,s){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var a=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),n=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,t),this._canvas=e.canvas||document.createElement("canvas"),this._size=e.size||{w:document.documentElement.clientWidth||window.innerWidth,h:document.documentElement.clientHeight||window.innerHeight},this._masks=e.masks,this._sourceToDraw=e.source,this._lnLoadedMasks=0,this._lnMasks=this._masks.length,this._sourceRect=this._getSourceRect(),this._initCanvas(),this._resize(),e.preload&&this.load()}return a(t,[{key:"isReady",value:function(){return this._lnMasks===this._lnLoadedMasks}},{key:"load",value:function(){this._isReady||this._loadNextMask()}},{key:"setSize",value:function(t,e){this._size.x===t&&this._size.y===e||(this._size.x=t,this._size.y=e,this._resize())}},{key:"addMask",value:function(){}},{key:"render",value:function(){this.isReady()&&(this._context.clearRect(0,0,this._size.w,this._size.h),this._context.drawImage(this._sourceToDraw,this._sourceRect.x,this._sourceRect.y,this._sourceRect.width,this._sourceRect.height),this._drawMasks())}},{key:"dispose",value:function(){}},{key:"_onMaskLoaded",value:function(t){var e=t.currentTarget,s=this._masks[this._lnLoadedMasks];s.src=e,s.width=s.width||e.width,s.height=s.height||e.height,++this._lnLoadedMasks,this.isReady()?this.render():this._loadNextMask()}},{key:"_initCanvas",value:function(){this._context=this._canvas.getContext("2d"),this._tmpCanvas=document.createElement("canvas"),this._tmpContext=this._tmpCanvas.getContext("2d")}},{key:"_loadNextMask",value:function(){var t=this._masks[this._lnLoadedMasks],e=new Image;e.onload=this._onMaskLoaded.bind(this),e.src=t.src}},{key:"_drawMasks",value:function(){for(var t=this._lnMasks;--t>-1;)this._drawMask(this._masks[t])}},{key:"_drawMask",value:function(t){var e=this._getRect(t.width,t.height);this._tmpContext.save(),this._tmpContext.clearRect(0,0,this._size.w,this._size.h),this._tmpContext.drawImage(t.src,e.x,e.y,e.width,e.height),this._tmpContext.globalCompositeOperation="source-atop",this._applyEffects(t.effects),this._tmpContext.drawImage(this._sourceToDraw,this._sourceRect.x,this._sourceRect.y,this._sourceRect.width,this._sourceRect.height),this._tmpContext.restore(),this._context.drawImage(this._tmpCanvas,0,0)}},{key:"_applyEffects",value:function(t){t.flip&&this._flip(t.flip),0!==t.rotate&&this._rotate(t.rotate),1!==t.scale&&this._scale(t.scale)}},{key:"_flip",value:function(t){"X"===t&&(this._tmpContext.translate(this._size.w,0),this._tmpContext.scale(-1,1)),"Y"===t&&(this._tmpContext.translate(0,this._size.h),this._tmpContext.scale(1,-1))}},{key:"_rotate",value:function(t){var e=t*(Math.PI/180);this._tmpContext.translate(this._size.w/2,this._size.h/2),this._tmpContext.rotate(e),this._tmpContext.translate(-this._size.w/2,-this._size.h/2)}},{key:"_scale",value:function(t){this._tmpContext.translate((this._size.w-this._size.w*t)/2,(this._size.h-this._size.h*t)/2),this._tmpContext.scale(t,t)}},{key:"_resize",value:function(){this._canvas.width=this._size.w,this._canvas.height=this._size.h,this._tmpCanvas.width=this._size.w,this._tmpCanvas.height=this._size.h,this._sourceRect=this._getSourceRect()}},{key:"_getSourceRect",value:function(){var t,e;if(this._sourceToDraw instanceof HTMLCanvasElement||this._sourceToDraw instanceof HTMLImageElement)t=this._sourceToDraw.width,e=this._sourceToDraw.height;else if(this._sourceToDraw instanceof HTMLVideoElement){var s=this._sourceToDraw.getBoundingClientRect();t=s.width,e=s.height}return this._getRect(t,e)}},{key:"_getRect",value:function(t,e){var s=Math.max(this._size.w/t,this._size.h/e),i=t*s,a=e*s,n=(this._size.w-i)/2,h=(this._size.h-a)/2;return{x:n,y:h,width:i,height:a}}},{key:"el",get:function(){return this._canvas}}]),t}();s["default"]=n},{}]},{},[1]);
